<html>
<head>
    <title>Html-Qrcode Demo</title>
<body>
    <h1>Q7</h1>
    <select name="camera" id="camera"></select>
    <div id="qr-scanner" style="width:500px"></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/1.2.4/html5-qrcode.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    let $camera = document.getElementById("camera")
    let html5QrCode

    Html5Qrcode.getCameras().then(devices => {
        for (let i = 0; i < devices.length; i++) {
            let option = document.createElement("option")
            option.text = devices[i].label
            option.value = devices[i].id
            $camera.add(option, $camera[0]);
        }

        if (devices && devices.length) {
            html5QrCode = new Html5Qrcode('qr-scanner')
            startCamera(devices[0].id)
        }
    }).catch(err => {})

    $camera.addEventListener('change', function() {
        stopCamera()
        startCamera(this.value)
    })

    function startCamera (cameraId) {
        html5QrCode.start(
        cameraId, 
        {
            fps: 10,    // Optional frame per seconds for qr code scanning
            qrbox: 250  // Optional if you want bounded box UI
        },
        qrCodeMessage => {
            let patient = `detail?id=${qrCodeMessage}`
            window.open(patient, '_blank')
        },
        errorMessage => {})
        .catch(err => {console.error(err)})
    }

    function stopCamera () {
        html5QrCode.stop().then(ignore => {
        // QR Code scanning is stopped.
        }).catch(err => {})
    }
})
</script>
</head>
</html>
